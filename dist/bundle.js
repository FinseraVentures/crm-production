/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e,t,r,n,o,a,s={26:(e,t,r)=>{r.a(e,async(e,t)=>{try{var n=r(818),o=r(928),a=r(355),s=r(887),i=r(695),u=r(113),c=r(195);function p(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return d(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(d(t={},n,function(){return this}),t),f=c.prototype=i.prototype=Object.create(l);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,d(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=c,d(f,"constructor",c),d(c,"constructor",u),u.displayName="GeneratorFunction",d(c,o,"GeneratorFunction"),d(f),d(f,o,"Generator"),d(f,n,function(){return this}),d(f,"toString",function(){return"[object Generator]"}),(p=function(){return{w:a,m}})()}function d(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}d=function(e,t,r,n){function a(t,r){d(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},d(e,t,r,n)}function l(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}await r.e(478).then(r.bind(r,478)),await r.e(276).then(r.bind(r,276)),n.config({path:o.resolve(process.cwd(),".env")}),process.on("uncaughtException",function(e){u.A.error("Uncaught Exception",e),process.exit(1)}),process.on("unhandledRejection",function(e){u.A.error("Unhandled Rejection",e)}),function(){var e,t=(e=p().m(function e(){var t;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,s.F)();case 1:i.A.info("âœ… Database connected"),a.A.listen(c.A.server.port,function(){i.A.info("ðŸš€ Server running on port ".concat(c.A.server.port))}),startKeepAliveCron(),e.n=3;break;case 2:e.p=2,t=e.v,i.A.error("âŒ Failed to start server",t),process.exit(1);case 3:return e.a(2)}},e,null,[[0,2]])}),function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){l(a,n,o,s,i,"next",e)}function i(e){l(a,n,o,s,i,"throw",e)}s(void 0)})});return function(){return t.apply(this,arguments)}}()(),t()}catch(f){t(f)}},1)},37:e=>{e.exports=require("mongoose")},113:(e,t,r)=>{r.d(t,{A:()=>u});var n=r(124),o=(r(233),n.createLogger),a=n.format,s=n.transports,i=new s.DailyRotateFile({filename:"logs/%DATE%-error.log",datePattern:"YYYY-MM-DD",level:"error",maxSize:"10m",maxFiles:"30d"});const u=o({level:"error",format:a.combine(a.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),a.json()),transports:[new s.Console,i]})},124:e=>{e.exports=require("winston")},195:(e,t,r)=>{r.d(t,{A:()=>p});var n=r(818),o=r(928);n.config({path:o.resolve(process.cwd(),".env")});var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=process.env[e];return void 0===r&&void 0===t&&console.warn("[ENV WARNING] Missing environment variable: ".concat(e)),null!=r?r:t},s=a("NODE_ENV","production"),i="development"===s,u="test"===s,c="production"===s;const p={nodeEnv:s,isDev:i,isTest:u,isProd:c,server:{port:a("PORT",5e3)},database:{uri:a(i?"MONGO_URI_DEV":u?"MONGO_URI_TEST":"MONGO_URI_PROD",a("MONGO_URI")),backupUri:a(i?"MONGO_BACKUP_URI_DEV":u?"MONGO_BACKUP_URI_TEST":"MONGO_BACKUP_URI_PROD",a("MONGO_BACKUP_URI"))},auth:{jwtSecret:a("JWT_SECRET"),jwtExpiresIn:a("JWT_EXPIRES_IN","7d")},logging:{level:a("LOG_LEVEL",i?"debug":"info"),toConsole:"true"===a("LOG_TO_CONSOLE","true"),toFile:"true"===a("LOG_TO_FILE",c?"true":"false"),directory:a("LOG_DIRECTORY","logs"),compress:"true"===a("LOG_COMPRESS",c?"true":"false"),external:{host:a("LOG_EXTERNAL_HOST",""),port:a("LOG_EXTERNAL_PORT",""),token:a("LOG_EXTERNAL_TOKEN","")}},cors:{origin:a("CORS_ORIGIN","*")},rateLimit:{windowMs:a("RATE_LIMIT_WINDOW","15m"),max:a("RATE_LIMIT_MAX",100)},razorpay:{keyId:a("RAZORPAY_KEY_ID"),keySecret:a("RAZORPAY_KEY_SECRET")},appscript:{url:a("APPSCRIPT_URL"),secret:a("APPSCRIPT_SECRET")}}},233:e=>{e.exports=require("winston-daily-rotate-file")},246:(e,t,r)=>{r.d(t,{A:()=>a});var n=r(37),o=n.Schema({name:{type:String,required:!0},companyName:{type:String},phoneNumber:{type:String,required:!0},email:{type:String,required:!0},location:{type:String},service:{type:String},message:{type:String},assignedTo:{type:String,required:!0,default:"unassigned"}},{timestamps:!0,versionKey:!1});const a=n.model("Email",o)},355:(e,t,r)=>{r.d(t,{A:()=>Gt});const n=require("express"),o=require("cors"),a=require("morgan");var s=r(695);const i=a("combined",{stream:{write:function(e){s.A.info(e.trim())}}});var u=r(37);console.log("User model loaded");var c=u.Schema({name:{type:String,required:!0},email:{type:String,required:!0,unique:!0},password:{type:String,required:!0},user_role:{type:String,required:!0},isActive:{type:Boolean,default:!1},resetPasswordToken:{type:String},resetPasswordExpires:{type:Date}},{timestamps:!1,versionKey:!1});const p=u.model("User",c);var d=u.Schema({user_id:{type:String,required:!0},bdm:{type:String,required:!0},branch_name:{type:String,required:!0},company_name:{type:String},contact_person:{type:String,required:!0},email:{type:String,required:!0},contact_no:{type:Number,required:!0},services:{type:[String],required:!0},closed_by:{type:String},total_amount:{type:Number,required:!0},term_1:{type:Number},term_2:{type:Number},term_3:{type:Number},payment_date:{type:Date},pan:{type:String},gst:{type:String},remark:{type:String},date:{type:Date,required:!0},after_disbursement:{type:String},bank:{type:String},state:{type:String,required:!0},status:{type:String},updatedhistory:[{updatedBy:String,updatedAt:{type:Date,default:Date.now},note:String,changes:{type:Map,of:new u.Schema({old:u.Schema.Types.Mixed,new:u.Schema.Types.Mixed},{_id:!1})}}],isDeleted:{type:Boolean,default:!1},deletedAt:{type:Date,default:null},deletedBy:{type:String,default:null}},{versionKey:!1,timestamps:!0});const l=u.model("Booking",d),f=require("crypto"),m=require("nodemailer"),y=require("bcrypt");var v=r(818);const g=require("jsonwebtoken");function b(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return h(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(h(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,h(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,h(d,"constructor",c),h(c,"constructor",u),u.displayName="GeneratorFunction",h(c,o,"GeneratorFunction"),h(d),h(d,o,"Generator"),h(d,n,function(){return this}),h(d,"toString",function(){return"[object Generator]"}),(b=function(){return{w:a,m:l}})()}function h(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}h=function(e,t,r,n){function a(t,r){h(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},h(e,t,r,n)}function w(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}var O=function(){var e,t=(e=b().m(function e(t,r,n){var o,a;return b().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,o=t.headers.authorization){e.n=1;break}return e.a(2,r.status(401).send({message:"Authentication required"}));case 1:a=g.verify(o,process.env.JWT_SECRET),t.user=a,n(),e.n=3;break;case 2:return e.p=2,e.v,e.a(2,r.status(401).send({message:"Invalid or expired token"}));case 3:return e.a(2)}},e,null,[[0,2]])}),function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){w(a,n,o,s,i,"next",e)}function i(e){w(a,n,o,s,i,"throw",e)}s(void 0)})});return function(e,r,n){return t.apply(this,arguments)}}(),k=function(e,t,r){var n;if("srdev"!==(null===(n=e.user)||void 0===n?void 0:n.user_role))return t.status(403).send({message:"Access denied. Only devs can access this route."});r()};function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach(function(t){P(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function P(e,t,r){return(t=function(e){var t=function(e){if("object"!=S(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==S(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function A(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return E(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(E(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,E(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,E(d,"constructor",c),E(c,"constructor",u),u.displayName="GeneratorFunction",E(c,o,"GeneratorFunction"),E(d),E(d,o,"Generator"),E(d,n,function(){return this}),E(d,"toString",function(){return"[object Generator]"}),(A=function(){return{w:a,m:l}})()}function E(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}E=function(e,t,r,n){function a(t,r){E(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},E(e,t,r,n)}function T(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function I(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){T(a,n,o,s,i,"next",e)}function i(e){T(a,n,o,s,i,"throw",e)}s(void 0)})}}v.config();var x=n.Router();x.post("/adduser",O,k,function(){var e=I(A().m(function e(t,r){var n,o,a,s,i,u,c,d,l,f;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=t.body,o=n.name,a=n.email,s=n.password,i=n.user_role,o&&a&&s){e.n=1;break}return e.a(2,r.status(400).send({message:"send all required fields: name, email, password"}));case 1:return u=a.toLowerCase(),e.n=2,p.findOne({email:u});case 2:if(!e.v){e.n=3;break}return e.a(2,r.status(409).send({message:"Email is already registered"}));case 3:return e.n=4,y.hash(s,5);case 4:return c=e.v,d={name:o,email:u,password:c,user_role:i},e.n=5,p.create(d);case 5:return l=e.v,e.a(2,r.status(201).send(l));case 6:return e.p=6,f=e.v,console.log(f.message),e.a(2,r.status(500).send({message:f.message}))}},e,null,[[0,6]])}));return function(t,r){return e.apply(this,arguments)}}()),x.patch("/edituser/:id",O,k,function(){var e=I(A().m(function e(t,r){var n,o,a,s;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=t.params.id,(o=t.body)&&0!==Object.keys(o).length){e.n=1;break}return e.a(2,r.status(400).send({message:"No fields provided for update"}));case 1:if(!o.email){e.n=3;break}return o.email=o.email.toLowerCase(),e.n=2,p.findOne({email:o.email,_id:{$ne:n}});case 2:if(!e.v){e.n=3;break}return e.a(2,r.status(409).send({message:"Email is already registered"}));case 3:if(!o.password){e.n=5;break}return e.n=4,y.hash(o.password,5);case 4:o.password=e.v;case 5:return e.n=6,p.findByIdAndUpdate(n,{$set:o},{new:!0,runValidators:!0});case 6:if(a=e.v){e.n=7;break}return e.a(2,r.status(404).send({message:"User not found"}));case 7:return e.a(2,r.status(200).send({message:"User updated successfully",user:a}));case 8:return e.p=8,s=e.v,console.error(s.message),e.a(2,r.status(500).send({message:s.message}))}},e,null,[[0,8]])}));return function(t,r){return e.apply(this,arguments)}}()),x.delete("/deleteuser/:id",O,k,function(){var e=I(A().m(function e(t,r){var n,o;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=t.params.id,e.n=1,p.findById(n);case 1:if(e.v){e.n=2;break}return e.a(2,r.status(404).send({message:"User not found"}));case 2:return e.n=3,p.findByIdAndDelete(n);case 3:return e.a(2,r.status(200).send({message:"User deleted successfully"}));case 4:return e.p=4,o=e.v,console.log(o.message),e.a(2,r.status(500).send({message:o.message}))}},e,null,[[0,4]])}));return function(t,r){return e.apply(this,arguments)}}()),x.get("/all",O,k,function(){var e=I(A().m(function e(t,r){var n,o;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,p.find({}).select("-password");case 1:if(0!==(n=e.v).length){e.n=2;break}return e.a(2,r.status(404).send({message:"No Users found"}));case 2:n.length,r.status(200).send({Users:n}),e.n=4;break;case 3:return e.p=3,o=e.v,console.log(o.message),e.a(2,r.status(500).send({message:o.message}));case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}());var N=function(e){return g.sign({userId:e._id,user_role:e.user_role},process.env.JWT_SECRET,{expiresIn:"24h"})};x.post("/auth/login",function(){var e=I(A().m(function e(t,r){var n,o,a,s,i,u,c;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=t.body,o=n.email,a=n.password,o&&a){e.n=1;break}return e.a(2,r.status(400).send({message:"Please provide both email and password."}));case 1:return e.n=2,p.findOneAndUpdate({email:o},{isActive:!0});case 2:if(s=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"User not found."}));case 3:return e.n=4,y.compare(a,s.password);case 4:if(e.v){e.n=5;break}return e.a(2,r.status(401).send({message:"Invalid email or password."}));case 5:i=N(s),delete(u=s.toObject()).password,r.status(200).json({success:!0,token:i,user:u}),e.n=7;break;case 6:return e.p=6,c=e.v,console.log(c.message),e.a(2,r.status(500).send({message:c.message}));case 7:return e.a(2)}},e,null,[[0,6]])}));return function(t,r){return e.apply(this,arguments)}}()),x.patch("/logout/:id",function(){var e=I(A().m(function e(t,r){var n,o,a;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.id,e.p=1,e.n=2,p.findByIdAndUpdate(n,{isActive:!1});case 2:if(o=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"User not found."}));case 3:r.send(o),e.n=5;break;case 4:return e.p=4,a=e.v,e.a(2,r.status(500).send({message:a.message}));case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}()),x.get("/bookings/:id",O,function(){var e=I(A().m(function e(t,r){var n,o,a;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,e.p=1,t.params.id){e.n=2;break}return e.a(2,r.status(400).send({message:"Not A VALID USER"}));case 2:return e.n=3,l.find({user_id:n});case 3:if(0!==(o=e.v).length){e.n=4;break}return e.a(2,r.status(404).send({message:"No bookings found for this user"}));case 4:r.status(200).send(o),e.n=6;break;case 5:return e.p=5,a=e.v,console.log(a.message),e.a(2,r.status(500).send({message:a.message}));case 6:return e.a(2)}},e,null,[[1,5]])}));return function(t,r){return e.apply(this,arguments)}}()),x.get("/:id?",O,function(){var e=I(A().m(function e(t,r){var n,o,a,s,i,u,c;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,o=t.query.pattern,a=t.query.userRole,s=t.query.userId,parseInt(o),e.p=1,!n){e.n=7;break}if(!["dev","admin","senior admin","srdev"].includes(a)){e.n=3;break}return e.n=2,i.find({_id:n});case 2:i=e.v,e.n=5;break;case 3:return e.n=4,i.find({_id:n,user_id:s});case 4:i=e.v;case 5:if(0!==i.length){e.n=6;break}return e.a(2,r.status(404).send({message:"No bookings found with this id"}));case 6:e.n=14;break;case 7:if(!o){e.n=13;break}if(u={$or:[{company_name:{$regex:o,$options:"i"}},{contact_person:{$regex:o,$options:"i"}},{email:{$regex:o,$options:"i"}},{pan:{$regex:o,$options:"i"}},{gst:{$regex:o,$options:"i"}},{services:{$regex:o,$options:"i"}},{bdm:{$regex:o,$options:"i"}},{$expr:{$regexMatch:{input:{$toString:"$contact_no"},regex:o}}}]},!["dev","admin","senior admin","srdev"].includes(a)){e.n=9;break}return e.n=8,i.find(u);case 8:i=e.v,e.n=11;break;case 9:return e.n=10,i.find(j(j({},u),{},{user_id:s}));case 10:i=e.v;case 11:if(0!==i.length){e.n=12;break}return e.a(2,r.status(404).send({message:"No bookings found matching the pattern"}));case 12:e.n=14;break;case 13:return e.a(2,r.status(400).send({message:"Either id or pattern query parameter is required"}));case 14:r.status(200).send(i),e.n=16;break;case 15:return e.p=15,c=e.v,console.log(c.message),e.a(2,r.status(500).send({message:c.message}));case 16:return e.a(2)}},e,null,[[1,15]])}));return function(t,r){return e.apply(this,arguments)}}()),x.get("/:id",function(){var e=I(A().m(function e(t,r){var n,o,a;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,e.p=1,t.params.id){e.n=2;break}return e.a(2,r.status(400).send({message:"Not A VALID USER"}));case 2:return e.n=3,o.find({_id:n});case 3:if(0!==(o=e.v).length){e.n=4;break}return e.a(2,r.status(404).send({message:"No User found with this id",status:!1}));case 4:r.status(200).send({message:"VALID USER",status:!0}),e.n=6;break;case 5:return e.p=5,a=e.v,console.log(a.message),e.a(2,r.status(500).send({message:a.message}));case 6:return e.a(2)}},e,null,[[1,5]])}));return function(t,r){return e.apply(this,arguments)}}()),x.put("/password-reset",function(){var e=I(A().m(function e(t,r){var n,o,a,s,i,u,c;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.body,o=n.password,(a=n.email)&&o){e.n=1;break}return e.a(2,r.status(400).send({message:"Please provide both email and new password"}));case 1:return s=a.toLowerCase(),e.p=2,e.n=3,p.findOne({email:s});case 3:if(i=e.v){e.n=4;break}return e.a(2,r.status(404).send({message:"User not found with this email"}));case 4:return e.n=5,y.hash(o,5);case 5:return u=e.v,i.password=u,e.n=6,i.save();case 6:return e.a(2,r.status(200).send({message:"Password updated successfully"}));case 7:return e.p=7,c=e.v,console.log(c.message),e.a(2,r.status(500).send({message:c.message}))}},e,null,[[2,7]])}));return function(t,r){return e.apply(this,arguments)}}()),x.post("/request-reset-password",function(){var e=I(A().m(function e(t,r){var n,o,a,s,i,u,c;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.body.email,e.p=1,e.n=2,p.findOne({email:n});case 2:if(o=e.v){e.n=3;break}return e.a(2,r.status(404).json({message:"User not found"}));case 3:return a=f.randomBytes(20).toString("hex"),s=Date.now()+36e5,o.resetPasswordToken=a,o.resetPasswordExpires=s,e.n=4,o.save();case 4:return i="http://localhost:5353/user/reset-password/".concat(a),u=m.createTransport({host:"smtp.hostinger.com",port:465,secure:!0,auth:{user:"siteadmin@enego.co.in",pass:"Siteadmin@enego@321"}}),c={to:o.email,from:"siteadmin@enego.co.in",subject:"Password Reset Request",text:"You are receiving this email because you (or someone else) have requested to reset the password for your account.\n\n\n      Please click the following link, or paste it into your browser to complete the process:\n\n\n      ".concat(i,"\n\n\n      If you did not request this, please ignore this email and your password will remain unchanged.")},e.n=5,u.sendMail(c);case 5:r.status(200).json({message:"Password reset link sent to your email."}),e.n=7;break;case 6:e.p=6,e.v,r.status(500).json({message:"Server error."});case 7:return e.a(2)}},e,null,[[1,6]])}));return function(t,r){return e.apply(this,arguments)}}()),x.post("/reset-password/:token",function(){var e=I(A().m(function e(t,r){var n,o,a,s,i;return A().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.token,o=t.body.newPassword,e.p=1,e.n=2,p.findOne({resetPasswordToken:n,resetPasswordExpires:{$gt:Date.now()}});case 2:if(a=e.v){e.n=3;break}return e.a(2,r.status(400).json({message:"Invalid or expired token"}));case 3:return e.n=4,y.genSalt(5);case 4:return s=e.v,e.n=5,y.hash(o,s);case 5:return i=e.v,a.password=i,a.resetPasswordToken=void 0,a.resetPasswordExpires=void 0,e.n=6,a.save();case 6:r.status(200).json({message:"Password reset successfully"}),e.n=8;break;case 7:e.p=7,e.v,r.status(500).json({message:"Server error"});case 8:return e.a(2)}},e,null,[[1,7]])}));return function(t,r){return e.apply(this,arguments)}}());const q=x;var G=["services"];function D(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function R(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return C(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(C(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,C(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,C(d,"constructor",c),C(c,"constructor",u),u.displayName="GeneratorFunction",C(c,o,"GeneratorFunction"),C(d),C(d,o,"Generator"),C(d,n,function(){return this}),C(d,"toString",function(){return"[object Generator]"}),(R=function(){return{w:a,m:l}})()}function C(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}C=function(e,t,r,n){function a(t,r){C(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},C(e,t,r,n)}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,s,i=[],u=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return F(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?F(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function U(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function M(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){U(a,n,o,s,i,"next",e)}function i(e){U(a,n,o,s,i,"throw",e)}s(void 0)})}}var L=n.Router();L.post("/addbooking",O,function(){var e=M(R().m(function e(t,r){var n,o,a,s,i,u,c,p,d,f,m,y,v,g,b,h,w,O,k,S,_,j,P,A,E,T,I,x;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.body,o=n.user_id,a=n.bdm,s=n.branch_name,i=n.company_name,u=n.contact_person,c=n.email,p=n.contact_no,d=n.services,f=n.total_amount,m=n.term_1,y=n.term_2,v=n.term_3,g=n.payment_date,b=n.closed_by,h=n.pan,w=n.gst,O=n.remark,k=n.date,S=n.status,_=n.bank,j=n.after_disbursement,P=n.state,A={branch_name:s,contact_person:u,user_id:o,bdm:a,email:c,services:d,total_amount:f,pan:h,state:P,date:k},!((E=Object.entries(A).filter(function(e){var t=B(e,2),r=t[0],n=t[1];return!n||"services"===r&&(!Array.isArray(n)||0===n.length)}).map(function(e){return B(e,1)[0]})).length>0)){e.n=1;break}return e.a(2,r.status(400).send({message:"Missing required fields: ".concat(E.join(", "))}));case 1:return e.p=1,T={user_id:o,bdm:a,branch_name:s,company_name:i||"",contact_person:u,email:c,contact_no:p,closed_by:b,services:d,total_amount:f,term_1:m,term_2:y,term_3:v,payment_date:g,pan:h,gst:w||"N/A",remark:O,date:k||new Date,status:S,bank:_,state:P,after_disbursement:j},e.n=2,l.create(T);case 2:return I=e.v,e.a(2,r.status(201).send({Message:"Booking Created Successfully",booking_id:I._id,booking:I}));case 3:return e.p=3,x=e.v,console.log(x),e.a(2,r.status(500).send({message:x.message}))}},e,null,[[1,3]])}));return function(t,r){return e.apply(this,arguments)}}()),L.patch("/editbooking/:id",O,function(){var e=M(R().m(function e(t,r){var n,o,a,s,i,u,c,p,d,f,m,y,v,g,b,h,w;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,o=t.body,a=t.headers["user-role"]){e.n=1;break}return e.a(2,r.status(400).send({message:"User role is required"}));case 1:return i=(s=o).updatedBy,u=s.note,delete o.updatedBy,delete o.note,e.p=2,e.n=3,l.findById(n);case 3:if(c=e.v){e.n=4;break}return e.a(2,r.status(404).send("Booking not found"));case 4:for(y in p=["dev","senior admin","srdev"],"admin"===a&&((d=o).services,f=D(d,G),o=f),m={},o)v=c[y],g=o[y],Array.isArray(v)?JSON.stringify(v)!==JSON.stringify(g)&&(m[y]={old:v,new:g}):v!==g&&(m[y]={old:v,new:g});if(0!==Object.keys(m).length){e.n=5;break}return e.a(2,r.status(400).send({message:"No changes detected"}));case 5:if(b={updatedBy:i||"Unknown",updatedAt:new Date,note:u||"",changes:m},!p.includes(a)&&"admin"!==a){e.n=7;break}return e.n=6,l.findByIdAndUpdate(n,{$set:o,$push:{updatedhistory:b}},{new:!0});case 6:return h=e.v,e.a(2,r.status(200).send({message:"Booking Updated Successfully",updatedBooking:h}));case 7:return e.a(2,r.status(403).send({message:"You do not have permission to edit this booking"}));case 8:return e.p=8,w=e.v,e.a(2,r.status(500).send({message:w.message}))}},e,null,[[2,8]])}));return function(t,r){return e.apply(this,arguments)}}()),L.patch("/trash/:id",O,function(){var e=M(R().m(function e(t,r){var n,o,a,s,i;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,o=t.headers["user-role"],a=t.headers["user-name"],o&&["srdev","dev"].includes(o)){e.n=1;break}return e.a(2,r.status(403).send({message:"Only dev or srdev can move bookings to trash."}));case 1:return e.p=1,e.n=2,l.findByIdAndUpdate(n,{isDeleted:!0,deletedAt:new Date,deletedBy:a||"Unknown"},{new:!0});case 2:if(s=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Booking not found"}));case 3:r.status(200).send({message:"Booking moved to trash",trashedBooking:s}),e.n=5;break;case 4:e.p=4,i=e.v,r.status(500).send({message:i.message});case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}()),L.get("/trash",O,function(){var e=M(R().m(function e(t,r){var n,o,a;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:if((n=t.headers["user-role"])&&"srdev"===n){e.n=1;break}return e.a(2,r.status(403).send({message:"Only srdev can view trash."}));case 1:return e.p=1,e.n=2,l.find({isDeleted:!0}).sort({deletedAt:-1});case 2:o=e.v,r.status(200).send(o),e.n=4;break;case 3:e.p=3,a=e.v,r.status(500).send({message:a.message});case 4:return e.a(2)}},e,null,[[1,3]])}));return function(t,r){return e.apply(this,arguments)}}()),L.patch("/restore/:id",O,function(){var e=M(R().m(function e(t,r){var n,o,a,s;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,(o=t.headers["user-role"])&&"srdev"===o){e.n=1;break}return e.a(2,r.status(403).send({message:"Only srdev can restore trashed bookings."}));case 1:return e.p=1,e.n=2,l.findByIdAndUpdate(n,{isDeleted:!1,deletedAt:null},{new:!0});case 2:if(a=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Booking not found"}));case 3:r.status(200).send({message:"Booking restored successfully",restoredBooking:a}),e.n=5;break;case 4:e.p=4,s=e.v,r.status(500).send({message:s.message});case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}()),L.delete("/deletebooking/:id",O,function(){var e=M(R().m(function e(t,r){var n,o,a;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,"srdev"===t.headers["user-role"]){e.n=1;break}return e.a(2,r.status(403).send({message:"Only srdev can permanently delete bookings."}));case 1:return e.n=2,l.findById(n);case 2:if(o=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Booking not found"}));case 3:if(o.isDeleted){e.n=4;break}return e.a(2,r.status(400).send({message:"You must move this booking to trash before deleting."}));case 4:return e.p=4,e.n=5,l.findByIdAndDelete(n);case 5:return e.a(2,r.status(200).send({message:"Booking permanently deleted."}));case 6:return e.p=6,a=e.v,e.a(2,r.status(500).send({message:a.message}))}},e,null,[[4,6]])}));return function(t,r){return e.apply(this,arguments)}}()),L.get("/getbooking/:id",O,function(){var e=M(R().m(function e(t,r){var n,o,a;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.id,e.p=1,e.n=2,l.findById(n);case 2:if(o=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Booking not found"}));case 3:return e.a(2,r.status(200).send({booking:o}));case 4:return e.p=4,a=e.v,e.a(2,r.status(500).send({message:a.message}))}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}()),L.get("/all",O,function(){var e=M(R().m(function e(t,r){var n,o;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,l.find({isDeleted:!1}).sort({createdAt:-1});case 1:if((n=e.v).length){e.n=2;break}return e.a(2,r.status(200).send({message:"No Bookings Found",Allbookings:[]}));case 2:return e.a(2,r.status(200).send({message:"All Bookings Fetched Successfully",Allbookings:n}));case 3:return e.p=3,o=e.v,console.error("Error in /all:",o.message),e.a(2,r.status(500).send({message:o.message}))}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}()),L.get("/bookings/filter",O,function(){var e=M(R().m(function e(t,r){var n,o,a,s,i,u,c,p,d,f,m,y,v,g,b,h,w,O,k,S,_,j,P,A,E,T;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.query,o=n.startDate,a=n.endDate,s=n.status,i=n.service,u=n.userId,c=n.userRole,p=n.bdmName,d=n.paymentmode,f=n.paymentStartDate,m=n.paymentEndDate,y=n.page,v=void 0===y?1:y,g=n.limit,b=void 0===g?100:g,h=parseInt(v,10),w=parseInt(b,10),e.p=1,O={},!o||!a||f||m){e.n=3;break}if(k=new Date(o),S=new Date(a),!isNaN(k)&&!isNaN(S)){e.n=2;break}return e.a(2,r.status(400).send({message:"Invalid booking date format"}));case 2:S.setHours(23,59,59,999),O.date={$gte:k,$lte:S};case 3:if(!f||!m){e.n=5;break}if(_=new Date(f),j=new Date(m),!isNaN(_)&&!isNaN(j)){e.n=4;break}return e.a(2,r.status(400).send({message:"Invalid payment date format"}));case 4:j.setHours(23,59,59,999),O.payment_date={$gte:_,$lte:j};case 5:if(!s){e.n=7;break}if(["Pending","In Progress","Completed"].includes(s)){e.n=6;break}return e.a(2,r.status(400).send({message:"Invalid status value"}));case 6:O.status=new RegExp("^".concat(s.trim(),"$"),"i");case 7:if(i&&(O.services={$in:[i]}),!d){e.n=9;break}if(["Kotak Mahindra Bank","HDFC Bank","Razorpay","HDFC Gateway","CashFree Gateway","Phonepe Gateway","Enego Projects","Cash"].includes(d)){e.n=8;break}return e.a(2,r.status(400).send({message:"Invalid payment mode"}));case 8:O.bank=d;case 9:if(p&&(O.bdm={$regex:new RegExp(p,"i")}),P=["dev","admin","senior admin","srdev"],c&&P.includes(c)){e.n=11;break}if(u){e.n=10;break}return e.a(2,r.status(403).send({message:"Access forbidden. No valid role or user ID provided."}));case 10:O.user_id=u;case 11:return O.isDeleted=!1,e.n=12,l.countDocuments(O);case 12:return A=e.v,e.n=13,l.find(O).sort({createdAt:-1}).skip((h-1)*w).limit(w);case 13:if((E=e.v).length){e.n=14;break}return e.a(2,r.status(200).send([]));case 14:r.status(200).send({bookings:E,totalCount:A,totalPages:Math.ceil(A/w),currentPage:h}),e.n=16;break;case 15:e.p=15,T=e.v,console.error("Error in /bookings/filter:",T.message),r.status(500).send({message:T.message});case 16:return e.a(2)}},e,null,[[1,15]])}));return function(t,r){return e.apply(this,arguments)}}()),L.get("/getbookings/user/:userId",O,function(){var e=M(R().m(function e(t,r){var n,o,a;return R().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.userId,e.p=1,e.n=2,l.find({user_id:n,isDeleted:!1}).sort({createdAt:-1});case 2:if((o=e.v).length){e.n=3;break}return e.a(2,r.status(200).send({message:"No bookings found for this user",bookings:[]}));case 3:return e.a(2,r.status(200).send({message:"User bookings fetched successfully",bookings:o}));case 4:return e.p=4,a=e.v,console.error("Error in /getbookings/user/:userId:",a.message),e.a(2,r.status(500).send({message:a.message}))}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}());const $=L;var Y=u.Schema({label:{type:String,required:!0},value:{type:String,required:!0,unique:!0},category:{type:String,default:""},processingTime:{type:String,default:""},status:{type:Boolean,required:!0,default:!0}},{timestamps:!1,versionKey:!1});const V=u.model("Service",Y);function H(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return W(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(W(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,W(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,W(d,"constructor",c),W(c,"constructor",u),u.displayName="GeneratorFunction",W(c,o,"GeneratorFunction"),W(d),W(d,o,"Generator"),W(d,n,function(){return this}),W(d,"toString",function(){return"[object Generator]"}),(H=function(){return{w:a,m:l}})()}function W(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}W=function(e,t,r,n){function a(t,r){W(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},W(e,t,r,n)}function Q(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function K(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){Q(a,n,o,s,i,"next",e)}function i(e){Q(a,n,o,s,i,"throw",e)}s(void 0)})}}var z=n.Router();z.post("/api/services",function(){var e=K(H().m(function e(t,r){var n,o,a,s,i,u,c;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.body,o=n.label,a=n.value,s=n.status,o&&a&&s){e.n=1;break}return e.a(2,r.status(400).send("Invalid input data"));case 1:return i={label:o,value:a,status:s},e.p=2,e.n=3,u.create(i);case 3:u=e.v,r.status(201).send({message:"Service added successfully",Service:u}),e.n=5;break;case 4:e.p=4,c=e.v,r.status(500).send({message:"Error adding service",error:c.message});case 5:return e.a(2)}},e,null,[[2,4]])}));return function(t,r){return e.apply(this,arguments)}}()),z.patch("/api/services/:id",O,k,function(){var e=K(H().m(function e(t,r){var n,o,a,s;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,(o=t.body)&&0!==Object.keys(o).length){e.n=1;break}return e.a(2,r.status(400).send({message:"No fields provided for update"}));case 1:return e.p=1,e.n=2,V.findByIdAndUpdate(n,{$set:o},{new:!0,runValidators:!0});case 2:if(a=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Service not found"}));case 3:r.status(200).send({message:"Service updated successfully",service:a}),e.n=5;break;case 4:e.p=4,s=e.v,r.status(500).send({message:"Error updating service",error:s.message});case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}()),z.get("/api/services",O,function(){var e=K(H().m(function e(t,r){var n,o;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,V.find();case 1:if((n=e.v)&&0!==n.length){e.n=2;break}return e.a(2,r.status(404).send({message:"No services found"}));case 2:r.status(200).send(n),e.n=4;break;case 3:e.p=3,o=e.v,console.error("Error fetching services:",o),r.status(500).send({message:"Error fetching services",error:o.message});case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}()),z.delete("/api/services/:id",O,k,function(){var e=K(H().m(function e(t,r){var n,o,a;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.id,e.p=1,e.n=2,V.findByIdAndDelete(n);case 2:if(o=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Service not found"}));case 3:r.status(200).send({message:"Service deleted successfully",service:o}),e.n=5;break;case 4:e.p=4,a=e.v,r.status(500).send({message:"Error deleting service",error:a.message});case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}());const J=z,X=require("cloudinary"),Z=require("multer-storage-cloudinary"),ee=require("multer");function te(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return re(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(re(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,re(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,re(d,"constructor",c),re(c,"constructor",u),u.displayName="GeneratorFunction",re(c,o,"GeneratorFunction"),re(d),re(d,o,"Generator"),re(d,n,function(){return this}),re(d,"toString",function(){return"[object Generator]"}),(te=function(){return{w:a,m:l}})()}function re(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}re=function(e,t,r,n){function a(t,r){re(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},re(e,t,r,n)}function ne(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}X.v2.config({cloud_name:process.env.CLOUDINARY_CLOUD_NAME,api_key:process.env.CLOUDINARY_API_KEY,api_secret:process.env.CLOUDINARY_API_SECRET});var oe,ae,se=ee({storage:new Z.CloudinaryStorage({cloudinary:X.v2,params:(oe=te().m(function e(t,r){var n,o,a,s,i;return te().w(function(e){for(;;)if(0===e.n)return o=Date.now(),a=(null===(n=t.user)||void 0===n?void 0:n.user_id)||"anonymous",s=r.originalname.split(".").pop(),i="".concat(a,"_").concat(r.fieldname,"_").concat(o,".").concat(s),e.a(2,{folder:"employee_profiles",public_id:i,allowed_formats:["jpg","jpeg","png"]})},e)}),ae=function(){var e=this,t=arguments;return new Promise(function(r,n){var o=oe.apply(e,t);function a(e){ne(o,r,n,a,s,"next",e)}function s(e){ne(o,r,n,a,s,"throw",e)}a(void 0)})},function(e,t){return ae.apply(this,arguments)})}),limits:{fileSize:5242880}});function ie(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return ue(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(ue(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,ue(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,ue(d,"constructor",c),ue(c,"constructor",u),u.displayName="GeneratorFunction",ue(c,o,"GeneratorFunction"),ue(d),ue(d,o,"Generator"),ue(d,n,function(){return this}),ue(d,"toString",function(){return"[object Generator]"}),(ie=function(){return{w:a,m:l}})()}function ue(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ue=function(e,t,r,n){function a(t,r){ue(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},ue(e,t,r,n)}function ce(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}var pe=u.Schema({userId:{type:u.Schema.Types.ObjectId,ref:"User",required:!0},employeeFullName:{type:String,required:!0},employeeId:{type:u.Schema.Types.ObjectId,ref:"User",required:!0},designation:{type:String,required:!0},department:{type:String,required:!0,enum:["Sales","Digital","Admin","Legal","Finance"]},branch:{type:String,required:!0,enum:["Main Branch","407 AMD"]},gender:{type:String,required:!0,enum:["Male","Female","Other"]},maritalStatus:{type:String,required:!0,enum:["Single","Married","Divorced","Widowed"]},dateOfBirth:{type:Date,required:!0},personalContactNumber:{type:String,required:!0},personalEmailAddress:{type:String,required:!0,lowercase:!0,trim:!0},workEmail:{type:String,required:!0,lowercase:!0,trim:!0},workPhoneNumber:{type:String,required:!0},permanentAddress:{type:String,required:!0},currentAddress:{type:String,required:!0},emergencyContactName:{type:String,required:!0},emergencyContactNumber:{type:String,required:!0},emergencyContactRelationship:{type:String,required:!0,enum:["Father","Mother","Spouse","Brother","Sister","Friend","Other"]},dateOfJoining:{type:Date,required:!0},reportingManager:{type:String,required:!0},offeredSalary:{type:String,required:!0},dateOfLastPromotion:{type:Date},educationQualification:{type:String,required:!0},previousEmployer:{type:String},totalWorkExperience:{type:String,required:!0},accountNumber:{type:String,required:!0},bankName:{type:String,required:!0},ifscCode:{type:String,required:!0},panNumber:{type:String,required:!0,uppercase:!0,trim:!0},aadharNumber:{type:String,required:!0},employeePhoto:{type:String,required:!0},aadhaarCardPhoto:{type:String,required:!0},isActive:{type:Boolean,default:!0},profileCompletionStatus:{type:String,enum:["incomplete","pending_review","approved","rejected"],default:"pending_review"},createdBy:{type:String},updatedBy:{type:String},approvedBy:{type:String},approvedAt:{type:Date},updateHistory:[{updatedBy:{type:String,required:!0},updatedAt:{type:Date,default:Date.now},changes:{type:Map,of:{oldValue:u.Schema.Types.Mixed,newValue:u.Schema.Types.Mixed}},reason:{type:String}}]},{timestamps:!0,versionKey:!1});pe.pre("save",function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){ce(a,n,o,s,i,"next",e)}function i(e){ce(a,n,o,s,i,"throw",e)}s(void 0)})}}(ie().m(function e(t){var r,n,o,a,s,i;return ie().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isNew||this.employeeId){e.n=4;break}return e.p=1,r={Sales:"SL",Digital:"DG",Admin:"AD",Legal:"LG",Finance:"FN"}[this.department]||"EMP",n=(new Date).getFullYear().toString().slice(-2),e.n=2,this.constructor.findOne({employeeId:new RegExp("^".concat(r).concat(n))}).sort({employeeId:-1});case 2:o=e.v,a=1,o&&o.employeeId&&(s=parseInt(o.employeeId.slice(-4)),a=s+1),this.employeeId="".concat(r).concat(n).concat(a.toString().padStart(4,"0")),this.createdBy=this.userId,e.n=4;break;case 3:return e.p=3,i=e.v,e.a(2,t(i));case 4:t();case 5:return e.a(2)}},e,this,[[1,3]])}));return function(t){return e.apply(this,arguments)}}()),pe.index({userId:1}),pe.index({employeeId:1}),pe.index({department:1}),pe.index({branch:1}),pe.index({personalEmailAddress:1}),pe.index({workEmail:1});const de=u.model("Employee",pe);function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach(function(t){ye(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ye(e,t,r){return(t=function(e){var t=function(e){if("object"!=le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==le(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ve(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return ge(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(ge(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,ge(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,ge(d,"constructor",c),ge(c,"constructor",u),u.displayName="GeneratorFunction",ge(c,o,"GeneratorFunction"),ge(d),ge(d,o,"Generator"),ge(d,n,function(){return this}),ge(d,"toString",function(){return"[object Generator]"}),(ve=function(){return{w:a,m:l}})()}function ge(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ge=function(e,t,r,n){function a(t,r){ge(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},ge(e,t,r,n)}function be(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,s,i=[],u=!0,c=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return he(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function we(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function Oe(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){we(a,n,o,s,i,"next",e)}function i(e){we(a,n,o,s,i,"throw",e)}s(void 0)})}}var ke=n.Router(),Se=function(e,t,r){if("HR"!==e.user.user_role)return t.status(403).json({message:"Access denied. Only HR personnel can perform this action."});r()};ke.use(O),ke.get("/all",Se,function(){var e=Oe(ve().m(function e(t,r){var n,o,a,s,i,u,c,p,d,l,f,m,y,v,g,b;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=t.query,o=n.page,a=void 0===o?1:o,s=n.limit,i=void 0===s?50:s,u=n.department,c=n.branch,p=n.status,d=n.search,l={isActive:!0},u&&(l.department=u),c&&(l.branch=c),p&&(l.profileCompletionStatus=p),d&&(l.$or=[{employeeFullName:{$regex:d,$options:"i"}},{employeeId:{$regex:d,$options:"i"}},{personalEmailAddress:{$regex:d,$options:"i"}},{workEmail:{$regex:d,$options:"i"}}]),f=(parseInt(a)-1)*parseInt(i),e.n=1,Promise.all([de.find(l).select("-updateHistory -__v").sort({createdAt:-1}).skip(f).limit(parseInt(i)),de.countDocuments(l)]);case 1:m=e.v,y=be(m,2),v=y[0],g=y[1],r.json({employees:v,pagination:{currentPage:parseInt(a),totalPages:Math.ceil(g/parseInt(i)),totalEmployees:g,hasNext:f+v.length<g,hasPrev:parseInt(a)>1}}),e.n=3;break;case 2:e.p=2,b=e.v,console.error("GET /all error:",b),r.status(500).json({error:"Server error",details:b.message});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()),ke.get("/profile/:id",function(e,t,r){var n=e.params.id;if(e.user.userId!==n&&"HR"!==e.user.role)return t.status(403).json({message:"Access denied. You can only access your own profile or need HR privileges."});r()},function(){var e=Oe(ve().m(function e(t,r){var n,o;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,de.findOne({userId:t.params.id,isActive:!0}).select("-updateHistory -__v");case 1:if(n=e.v){e.n=2;break}return e.a(2,r.status(404).json({error:"Profile not found"}));case 2:r.json({profile:n}),e.n=4;break;case 3:e.p=3,o=e.v,console.error("GET /profile/:id error:",o),r.status(500).json({error:"Server error",details:o.message});case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}()),ke.post("/profile",se.fields([{name:"employeePhoto",maxCount:1},{name:"aadhaarCardPhoto",maxCount:1}]),function(e,t,r){var n=["employeeFullName","designation","department","branch","gender","maritalStatus","dateOfBirth","personalContactNumber","personalEmailAddress","workEmail","workPhoneNumber","permanentAddress","currentAddress","emergencyContactName","emergencyContactNumber","emergencyContactRelationship","dateOfJoining","reportingManager","offeredSalary","educationQualification","totalWorkExperience","accountNumber","bankName","ifscCode","panNumber","aadharNumber"].filter(function(t){return!e.body[t]});if(n.length>0)return t.status(400).json({error:"Missing required fields",missingFields:n});var o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(!o.test(e.body.personalEmailAddress)||!o.test(e.body.workEmail))return t.status(400).json({error:"Invalid email format"});var a=/^\d{10}$/;return a.test(e.body.personalContactNumber.replace(/\D/g,""))&&a.test(e.body.workPhoneNumber.replace(/\D/g,""))?/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/.test(e.body.panNumber.toUpperCase())?/^\d{12}$/.test(e.body.aadharNumber.replace(/\D/g,""))?void r():t.status(400).json({error:"Invalid Aadhar number format"}):t.status(400).json({error:"Invalid PAN number format"}):t.status(400).json({error:"Invalid phone number format"})},function(){var e=Oe(ve().m(function e(t,r){var n,o,a,s,i,u,c;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,de.findOne({userId:t.user.userId});case 1:if(!e.v){e.n=2;break}return e.a(2,r.status(400).json({error:"Profile already exists for this user"}));case 2:if(null!==(n=t.files)&&void 0!==n&&n.employeePhoto&&null!==(o=t.files)&&void 0!==o&&o.aadhaarCardPhoto){e.n=3;break}return e.a(2,r.status(400).json({error:"Both employee photo and Aadhaar card photo are required"}));case 3:return e.n=4,de.findOne({$or:[{personalEmailAddress:t.body.personalEmailAddress.toLowerCase()},{workEmail:t.body.workEmail.toLowerCase()}]});case 4:if(!e.v){e.n=5;break}return e.a(2,r.status(400).json({error:"Email address already exists in the system"}));case 5:return a=me(me({userId:t.user.userId},t.body),{},{personalEmailAddress:t.body.personalEmailAddress.toLowerCase(),workEmail:t.body.workEmail.toLowerCase(),panNumber:t.body.panNumber.toUpperCase(),employeePhoto:t.files.employeePhoto[0].path,aadhaarCardPhoto:t.files.aadhaarCardPhoto[0].path,createdBy:t.user.userId}),s=new de(a),e.n=6,s.save();case 6:delete(i=s.toObject()).updateHistory,r.status(201).json({message:"Employee profile created successfully",profile:i}),e.n=9;break;case 7:if(e.p=7,c=e.v,console.error("POST /profile error:",c),11e3!==c.code){e.n=8;break}return u=Object.keys(c.keyPattern)[0],e.a(2,r.status(400).json({error:"".concat(u," already exists in the system")}));case 8:r.status(500).json({error:"Server error",details:c.message});case 9:return e.a(2)}},e,null,[[0,7]])}));return function(t,r){return e.apply(this,arguments)}}()),ke.put("/update/:id",Se,function(){var e=Oe(ve().m(function e(t,r){var n,o,a,s,i,u,c,p;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,de.findOne({userId:t.params.id,isActive:!0});case 1:if(a=e.v){e.n=2;break}return e.a(2,r.status(404).json({error:"Profile not found"}));case 2:if(s=new Map,i={},["employeeFullName","designation","department","branch","gender","maritalStatus","dateOfBirth","personalContactNumber","personalEmailAddress","workEmail","workPhoneNumber","permanentAddress","currentAddress","emergencyContactName","emergencyContactNumber","emergencyContactRelationship","dateOfJoining","reportingManager","dateOfLastPromotion","educationQualification","previousEmployer","totalWorkExperience","accountNumber","bankName","ifscCode","panNumber","aadharNumber"].forEach(function(e){void 0!==t.body[e]&&t.body[e]!==a[e]&&(s.set(e,{oldValue:a[e],newValue:t.body[e]}),i[e]=t.body[e])}),null!==(n=t.files)&&void 0!==n&&n.employeePhoto&&(s.set("employeePhoto",{oldValue:a.employeePhoto,newValue:t.files.employeePhoto[0].path}),i.employeePhoto=t.files.employeePhoto[0].path),null!==(o=t.files)&&void 0!==o&&o.aadhaarCardPhoto&&(s.set("aadhaarCardPhoto",{oldValue:a.aadhaarCardPhoto,newValue:t.files.aadhaarCardPhoto[0].path}),i.aadhaarCardPhoto=t.files.aadhaarCardPhoto[0].path),0!==Object.keys(i).length){e.n=3;break}return e.a(2,r.status(400).json({message:"No changes detected"}));case 3:return i.updatedBy=t.user.userId,i.$push={updateHistory:{updatedBy:t.user.userId,changes:s,reason:t.body.updateReason||"Profile update"}},e.n=4,de.findOneAndUpdate({userId:t.params.id},i,{new:!0,runValidators:!0}).select("-updateHistory -__v");case 4:u=e.v,r.json({message:"Profile updated successfully",profile:u,changesCount:s.size}),e.n=7;break;case 5:if(e.p=5,p=e.v,console.error("PUT /update/:id error:",p),11e3!==p.code){e.n=6;break}return c=Object.keys(p.keyPattern)[0],e.a(2,r.status(400).json({error:"".concat(c," already exists in the system")}));case 6:r.status(500).json({error:"Server error",details:p.message});case 7:return e.a(2)}},e,null,[[0,5]])}));return function(t,r){return e.apply(this,arguments)}}()),ke.delete("/delete/:id",Se,function(){var e=Oe(ve().m(function e(t,r){var n,o;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,de.findOneAndUpdate({userId:t.params.id,isActive:!0},{isActive:!1,updatedBy:t.user.userId,$push:{updateHistory:{updatedBy:t.user.userId,changes:new Map([["isActive",{oldValue:!0,newValue:!1}]]),reason:t.body.reason||"Profile deactivated"}}},{new:!0});case 1:if(n=e.v){e.n=2;break}return e.a(2,r.status(404).json({error:"Profile not found"}));case 2:r.json({message:"Employee profile deactivated successfully",employeeId:n.employeeId}),e.n=4;break;case 3:e.p=3,o=e.v,console.error("DELETE /delete/:id error:",o),r.status(500).json({error:"Server error",details:o.message});case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}()),ke.post("/approve/:id",Se,function(){var e=Oe(ve().m(function e(t,r){var n,o;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,de.findOneAndUpdate({userId:t.params.id,isActive:!0},{profileCompletionStatus:"approved",approvedBy:t.user.userId,approvedAt:new Date,updatedBy:t.user.userId,$push:{updateHistory:{updatedBy:t.user.userId,changes:new Map([["profileCompletionStatus",{oldValue:"pending_review",newValue:"approved"}]]),reason:"Profile approved by HR"}}},{new:!0}).select("-updateHistory -__v");case 1:if(n=e.v){e.n=2;break}return e.a(2,r.status(404).json({error:"Profile not found"}));case 2:r.json({message:"Employee profile approved successfully",profile:n}),e.n=4;break;case 3:e.p=3,o=e.v,console.error("POST /approve/:id error:",o),r.status(500).json({error:"Server error",details:o.message});case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}()),ke.get("/stats",Se,function(){var e=Oe(ve().m(function e(t,r){var n,o,a,s,i,u,c,p;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Promise.all([de.countDocuments({isActive:!0}),de.aggregate([{$match:{isActive:!0}},{$group:{_id:"$department",count:{$sum:1}}},{$sort:{count:-1}}]),de.aggregate([{$match:{isActive:!0}},{$group:{_id:"$branch",count:{$sum:1}}},{$sort:{count:-1}}]),de.aggregate([{$match:{isActive:!0}},{$group:{_id:"$profileCompletionStatus",count:{$sum:1}}}]),de.find({isActive:!0}).sort({dateOfJoining:-1}).limit(5).select("employeeFullName employeeId department dateOfJoining")]);case 1:n=e.v,o=be(n,5),a=o[0],s=o[1],i=o[2],u=o[3],c=o[4],r.json({totalEmployees:a,departmentStats:s,branchStats:i,statusStats:u,recentJoinees:c}),e.n=3;break;case 2:e.p=2,p=e.v,console.error("GET /stats error:",p),r.status(500).json({error:"Server error",details:p.message});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()),ke.get("/export",Se,function(){var e=Oe(ve().m(function e(t,r){var n,o,a,s,i,u,c,p,d,l;return ve().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=t.query,o=n.format,a=void 0===o?"json":o,s=n.department,i=n.branch,u={isActive:!0},s&&(u.department=s),i&&(u.branch=i),e.n=1,de.find(u).select("-updateHistory -__v -employeePhoto -aadhaarCardPhoto").sort({employeeId:1});case 1:c=e.v,"csv"===a?(p=["Employee ID","Full Name","Designation","Department","Branch","Personal Email","Work Email","Personal Phone","Work Phone","Date of Joining","Reporting Manager"].join(","),d=c.map(function(e){var t;return[e.employeeId,e.employeeFullName,e.designation,e.department,e.branch,e.personalEmailAddress,e.workEmail,e.personalContactNumber,e.workPhoneNumber,(null===(t=e.dateOfJoining)||void 0===t?void 0:t.toISOString().split("T")[0])||"",e.reportingManager].join(",")}).join("\n"),r.setHeader("Content-Type","text/csv"),r.setHeader("Content-Disposition","attachment; filename=employees.csv"),r.send(p+"\n"+d)):r.json({employees:c,count:c.length}),e.n=3;break;case 2:e.p=2,l=e.v,console.error("GET /export error:",l),r.status(500).json({error:"Server error",details:l.message});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}());const _e=ke;var je=u.Schema({invoiceNumber:{type:String,required:!0},date:{type:String,required:!0},clientCompanyName:{type:String,required:!0},clientName:{type:String,required:!0},clientEmail:{type:String,required:!0},clientAddress:{type:String},clientGstNumber:{type:Number},items:{type:Array,required:!0},subtotal:{type:Number,required:!0},gstRate:{type:Number},gstAmount:{type:Number,required:!0},total:{type:Number,required:!0},includeGst:{type:Boolean},user:{type:u.Schema.Types.ObjectId,ref:"User",required:!0}},{timestamps:!1,versionKey:!1});const Pe=u.model("Invoice",je);function Ae(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return Ee(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(Ee(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Ee(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,Ee(d,"constructor",c),Ee(c,"constructor",u),u.displayName="GeneratorFunction",Ee(c,o,"GeneratorFunction"),Ee(d),Ee(d,o,"Generator"),Ee(d,n,function(){return this}),Ee(d,"toString",function(){return"[object Generator]"}),(Ae=function(){return{w:a,m:l}})()}function Ee(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Ee=function(e,t,r,n){function a(t,r){Ee(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},Ee(e,t,r,n)}function Te(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function Ie(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){Te(a,n,o,s,i,"next",e)}function i(e){Te(a,n,o,s,i,"throw",e)}s(void 0)})}}var xe=n.Router();xe.post("/",function(){var e=Ie(Ae().m(function e(t,r){var n,o;return Ae().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=new Pe(t.body),e.n=1,n.save();case 1:r.status(201).json(n),e.n=3;break;case 2:e.p=2,o=e.v,r.status(400).json({error:o.message});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()),xe.get("/",function(){var e=Ie(Ae().m(function e(t,r){var n,o;return Ae().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pe.find();case 1:n=e.v,r.json(n),e.n=3;break;case 2:e.p=2,o=e.v,r.status(500).json({error:o.message});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()),xe.get("/:id",function(){var e=Ie(Ae().m(function e(t,r){var n,o;return Ae().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pe.findById(t.params.id);case 1:if(n=e.v){e.n=2;break}return e.a(2,r.status(404).json({error:"Invoice not found"}));case 2:r.json(n),e.n=4;break;case 3:e.p=3,o=e.v,r.status(500).json({error:o.message});case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}()),xe.put("/:id",function(){var e=Ie(Ae().m(function e(t,r){var n,o;return Ae().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pe.findByIdAndUpdate(t.params.id,t.body,{new:!0});case 1:if(n=e.v){e.n=2;break}return e.a(2,r.status(404).json({error:"Invoice not found"}));case 2:r.json(n),e.n=4;break;case 3:e.p=3,o=e.v,r.status(400).json({error:o.message});case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}()),xe.delete("/:id",function(){var e=Ie(Ae().m(function e(t,r){var n;return Ae().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pe.findByIdAndDelete(t.params.id);case 1:if(e.v){e.n=2;break}return e.a(2,r.status(404).json({error:"Invoice not found"}));case 2:r.json({message:"Invoice deleted"}),e.n=4;break;case 3:e.p=3,n=e.v,r.status(500).json({error:n.message});case 4:return e.a(2)}},e,null,[[0,3]])}));return function(t,r){return e.apply(this,arguments)}}());const Ne=xe;var qe=r(246);function Ge(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return De(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(De(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,De(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,De(d,"constructor",c),De(c,"constructor",u),u.displayName="GeneratorFunction",De(c,o,"GeneratorFunction"),De(d),De(d,o,"Generator"),De(d,n,function(){return this}),De(d,"toString",function(){return"[object Generator]"}),(Ge=function(){return{w:a,m:l}})()}function De(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}De=function(e,t,r,n){function a(t,r){De(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},De(e,t,r,n)}function Re(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function Ce(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){Re(a,n,o,s,i,"next",e)}function i(e){Re(a,n,o,s,i,"throw",e)}s(void 0)})}}var Be=n.Router();Be.get("/all",function(){var e=Ce(Ge().m(function e(t,r){var n,o,a,s,i;return Ge().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=Number(t.query.page)||1,o=Number(t.query.limit)||50,a=(n-1)*o,e.n=1,qe.A.find({assignedTo:"unassigned",isDeleted:!1},{name:1,companyName:1,phoneNumber:1,email:1,location:1,service:1,createdAt:1,assignedTo:1}).sort({createdAt:-1}).skip(a).limit(o).lean();case 1:return s=e.v,e.a(2,r.status(200).send({page:n,limit:o,count:s.length,leads:s}));case 2:return e.p=2,i=e.v,console.error(i),e.a(2,r.status(500).send({message:i.message}))}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()),Be.patch("/edit/:id",O,function(){var e=Ce(Ge().m(function e(t,r){var n,o,a,s,i;return Ge().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.id,o=t.body,e.p=1,e.n=2,qe.A.findById(n);case 2:if((a=e.v)&&!a.isDeleted){e.n=3;break}return e.a(2,r.status(404).send({message:"Lead not found"}));case 3:return e.n=4,qe.A.findByIdAndUpdate(n,{$set:o},{new:!0});case 4:return s=e.v,e.a(2,r.status(200).send({message:"Lead updated",updated:s}));case 5:return e.p=5,i=e.v,console.error(i),e.a(2,r.status(500).send({message:i.message}))}},e,null,[[1,5]])}));return function(t,r){return e.apply(this,arguments)}}()),Be.patch("/trash/:id",O,function(){var e=Ce(Ge().m(function e(t,r){var n,o,a,s;return Ge().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.id,o=t.headers["user-name"]||"Unknown",e.p=1,e.n=2,qe.A.findById(n);case 2:if((a=e.v)&&!a.isDeleted){e.n=3;break}return e.a(2,r.status(404).send({message:"Lead not found"}));case 3:return a.isDeleted=!0,a.deletedAt=new Date,a.deletedBy=o,e.n=4,a.save();case 4:return e.a(2,r.status(200).send({message:"Lead moved to trash",lead:a}));case 5:return e.p=5,s=e.v,console.error(s),e.a(2,r.status(500).send({message:s.message}))}},e,null,[[1,5]])}));return function(t,r){return e.apply(this,arguments)}}()),Be.delete("/delete/:id",O,function(){var e=Ce(Ge().m(function e(t,r){var n,o;return Ge().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,"srdev"===t.headers["user-role"]){e.n=1;break}return e.a(2,r.status(403).send({message:"Only srdev can permanently delete leads."}));case 1:return e.p=1,e.n=2,qe.A.findById(n);case 2:if(e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Lead not found"}));case 3:return e.n=4,qe.A.findByIdAndDelete(n);case 4:return e.a(2,r.status(200).send({message:"Lead permanently deleted"}));case 5:return e.p=5,o=e.v,console.error(o),e.a(2,r.status(500).send({message:o.message}))}},e,null,[[1,5]])}));return function(t,r){return e.apply(this,arguments)}}());const Fe=Be;function Ue(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return Me(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(Me(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Me(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,Me(d,"constructor",c),Me(c,"constructor",u),u.displayName="GeneratorFunction",Me(c,o,"GeneratorFunction"),Me(d),Me(d,o,"Generator"),Me(d,n,function(){return this}),Me(d,"toString",function(){return"[object Generator]"}),(Ue=function(){return{w:a,m:l}})()}function Me(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Me=function(e,t,r,n){function a(t,r){Me(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},Me(e,t,r,n)}function Le(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function $e(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){Le(a,n,o,s,i,"next",e)}function i(e){Le(a,n,o,s,i,"throw",e)}s(void 0)})}}var Ye=n.Router();Ye.post("/login",function(){var e=$e(Ue().m(function e(t,r){var n,o,a,s,i,u;return Ue().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=t.body,o=n.email,a=n.password,o&&a){e.n=1;break}return e.a(2,r.status(400).send({message:"Please provide both email and password."}));case 1:return e.n=2,p.findOneAndUpdate({email:o},{isActive:!0});case 2:if(s=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"User not found."}));case 3:return e.n=4,y.compare(a,s.password);case 4:if(e.v){e.n=5;break}return e.a(2,r.status(401).send({message:"Invalid email or password."}));case 5:i=Ve(s),r.status(200).send({token:i,user:s}),e.n=7;break;case 6:return e.p=6,u=e.v,console.log(u.message),e.a(2,r.status(500).send({message:u.message}));case 7:return e.a(2)}},e,null,[[0,6]])}));return function(t,r){return e.apply(this,arguments)}}()),Ye.patch("/logout/:id",function(){var e=$e(Ue().m(function e(t,r){var n,o,a;return Ue().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.id,e.p=1,e.n=2,p.findByIdAndUpdate(n,{isActive:!1});case 2:if(o=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"User not found."}));case 3:r.send(o),e.n=5;break;case 4:return e.p=4,a=e.v,e.a(2,r.status(500).send({message:a.message}));case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}());var Ve=function(e){return g.sign({userId:e._id,user_role:e.user_role},process.env.JWT_SECRET,{expiresIn:"24h"})};const He=Ye,We=require("razorpay");function Qe(e){return Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(e)}function Ke(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return ze(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(ze(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,ze(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,ze(d,"constructor",c),ze(c,"constructor",u),u.displayName="GeneratorFunction",ze(c,o,"GeneratorFunction"),ze(d),ze(d,o,"Generator"),ze(d,n,function(){return this}),ze(d,"toString",function(){return"[object Generator]"}),(Ke=function(){return{w:a,m:l}})()}function ze(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ze=function(e,t,r,n){function a(t,r){ze(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},ze(e,t,r,n)}function Je(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(r),!0).forEach(function(t){Ze(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Je(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ze(e,t,r){return(t=function(e){var t=function(e){if("object"!=Qe(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Qe(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Qe(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function et(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}var tt=process.env.APPSCRIPT_URL,rt=process.env.APPSCRIPT_SECRET;function nt(e){return ot.apply(this,arguments)}function ot(){return ot=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){et(a,n,o,s,i,"next",e)}function i(e){et(a,n,o,s,i,"throw",e)}s(void 0)})}}(Ke().m(function e(t){var r,n,o;return Ke().w(function(e){for(;;)switch(e.n){case 0:if(tt){e.n=1;break}throw new Error("APPSCRIPT_URL not configured");case 1:return r=Xe(Xe({},t),{},{__secret:rt}),console.log(t,"Payload"),e.n=2,fetch(tt,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 2:return n=e.v,e.n=3,n.json().catch(function(){return null});case 3:if((o=e.v)&&o.success){e.n=4;break}throw console.error("Failed to append to Google Sheet",o),new Error((null==o?void 0:o.message)||"Failed to append to Google Sheet");case 4:return e.a(2,o)}},e)})),ot.apply(this,arguments)}var at=new u.Schema({customerName:{type:String,required:!0,trim:!0},contact:{type:String,required:!0,trim:!0},amount:{type:Number,required:!0,min:1},user:{type:u.Schema.Types.ObjectId,ref:"User",required:!0},description:{type:String,trim:!0,default:""},link:{type:String,required:!0,unique:!0,trim:!0},status:{type:String,enum:["pending","paid","expired","failed"],default:"pending"}},{timestamps:!0});const st=u.model("PaymentLink",at);var it=new u.Schema({name:{type:String,required:!0},user:{type:u.Schema.Types.ObjectId,ref:"User",required:!0},amount:{type:Number,required:!0},description:{type:String},qr_id:{type:String,required:!0,unique:!0},qr_image:{type:String},qr_base64:{type:String},usage:{type:String,default:"single_use"},purpose:{type:String,default:"UPI QR Payment"},fixed_amount:{type:Boolean,default:!0},close_by:{type:Number},status:{type:String,default:"Pending",enum:["Pending","Paid","Expired","Cancelled"]}},{timestamps:!0});const ut=u.model("PaymentQr",it);function ct(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return pt(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(pt(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,pt(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,pt(d,"constructor",c),pt(c,"constructor",u),u.displayName="GeneratorFunction",pt(c,o,"GeneratorFunction"),pt(d),pt(d,o,"Generator"),pt(d,n,function(){return this}),pt(d,"toString",function(){return"[object Generator]"}),(ct=function(){return{w:a,m:l}})()}function pt(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}pt=function(e,t,r,n){function a(t,r){pt(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},pt(e,t,r,n)}function dt(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function lt(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){dt(a,n,o,s,i,"next",e)}function i(e){dt(a,n,o,s,i,"throw",e)}s(void 0)})}}v.config();var ft=n.Router(),mt=new We({key_id:process.env.RAZORPAY_KEY_ID,key_secret:process.env.RAZORPAY_KEY_SECRET});ft.post("/create-upi-link",O,function(){var e=lt(ct().m(function e(t,r){var n,o,a,s,i,u,c,p,d,l,f,m,y,v,g,b;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=t.body,o=n.amount,a=n.name,s=n.email,i=n.phone,u=n.description,c=n.notifyEmail,p=void 0===c||c,d=n.notifySms,l=void 0===d||d,f=n.user,m=n.userName,console.log(t.body),o&&s&&i){e.n=1;break}return e.a(2,r.status(400).json({message:"Amount, email & phone are required."}));case 1:return e.n=2,mt.paymentLink.create({amount:Math.round(100*o),currency:"INR",accept_partial:!1,description:u||"UPI Payment",customer:{name:a||"Customer",email:s,contact:i},notify:{sms:l,email:p},reminder_enable:!0,notes:{purpose:"UPI Payment Link"},callback_url:"https://your-frontend-url.com/payment-status",callback_method:"get"});case 2:return y=e.v,e.p=3,e.n=4,nt({type:"LINK",timestamp:(new Date).toISOString(),description:u,email:s,phone:i,bdm:m,paymentLink:y.short_url,amount:o,status:"pending",name:a});case 4:e.n=6;break;case 5:e.p=5,g=e.v,console.error("Sheet logging failed:",g);case 6:return e.n=7,st.create({customerName:a,contact:i,amount:o,user:f,description:u,link:y.short_url,status:"pending",createdOn:new Date});case 7:return e.a(2,r.status(200).json({success:!0,message:"Payment link created",payment_link_id:y.id,short_url:y.short_url}));case 8:e.p=8,b=e.v,console.error("âŒ Razorpay Error:",b),r.status(500).json({message:(null===(v=b.error)||void 0===v?void 0:v.description)||b.message||"Payment link creation failed."});case 9:return e.a(2)}},e,null,[[3,5],[0,8]])}));return function(t,r){return e.apply(this,arguments)}}()),ft.post("/create-qr",O,function(){var e=lt(ct().m(function e(t,r){var n,o,a,s,i,u,c,p,d,l,f,m,y,v,g,b,h,w,O,k,S;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n=t.body,o=n.amount,a=n.user,s=n.name,i=n.description,u=n.customer_id,c=n.purpose,p=n.usage,d=n.fixed_amount,l=n.close_by_hours,f=n.userName,console.log(t.body),o&&s){e.n=1;break}return e.a(2,r.status(400).json({success:!1,message:"amount and name are required"}));case 1:return m=Math.floor(Date.now()/1e3)+(l?3600*l:86400),y={type:"upi_qr",name:s,usage:p||"single_use",fixed_amount:null==d||d,payment_amount:Math.round(100*o),description:i||"UPI QR Payment",close_by:m,notes:{purpose:c||"UPI QR Payment"}},u&&(y.customer_id=u),e.n=2,mt.qrCode.create(y);case 2:return v=e.v,g=null,e.p=3,e.n=4,fetch(v.image_url);case 4:return b=e.v,e.n=5,b.arrayBuffer();case 5:h=e.v,g=Buffer.from(h).toString("base64"),e.n=7;break;case 6:e.p=6,O=e.v,console.error("Failed to fetch/convert QR image:",O);case 7:return lt(ct().m(function e(){var t;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,nt({type:"QR",name:s,bdm:f,amount:o,description:i,qr_id:v.id,qr_image:v.image_url,usage:p,purpose:c,fixed_amount:d,close_by:m,status:"Pending"});case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("Sheet logging failed:",t);case 3:return e.a(2)}},e,null,[[0,2]])}))(),w=null,e.p=8,e.n=9,ut.create({name:s,user:a,amount:o,description:i,qr_id:v.id,qr_image:v.image_url,usage:p||"single_use",purpose:c||"UPI QR Payment",fixed_amount:null==d||d,close_by:m,qr_base64:g?"data:image/png;base64,".concat(g):null,status:"Pending",createdOn:new Date});case 9:w=e.v,e.n=11;break;case 10:e.p=10,k=e.v,console.error("Failed to save QR to DB:",k);case 11:return e.a(2,r.status(201).json({success:!0,message:"QR Code created",qr_id:v.id,qr_data:v,qr_base64:g?"data:image/png;base64,".concat(g):null,savedRecord:w}));case 12:return e.p=12,S=e.v,console.error("QR create error:",S),e.a(2,r.status(500).json({success:!1,message:S.message||"QR creation failed"}))}},e,null,[[8,10],[3,6],[0,12]])}));return function(t,r){return e.apply(this,arguments)}}()),ft.get("/payment-links",O,function(){var e=lt(ct().m(function e(t,r){var n,o;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,st.find().sort({createdOn:-1});case 1:n=e.v,r.json({success:!0,count:n.length,data:n}),e.n=3;break;case 2:e.p=2,o=e.v,r.status(500).json({success:!1,error:o.message});case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()),ft.patch("/api/payment-links/:id/status",O,function(){var e=lt(ct().m(function e(t,r){var n,o,a,s;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,o=t.body.status){e.n=1;break}return e.a(2,r.status(400).json({success:!1,message:"Status is required."}));case 1:return e.p=1,e.n=2,st.findByIdAndUpdate(n,{$set:{status:o}},{new:!0,runValidators:!0});case 2:if(a=e.v){e.n=3;break}return e.a(2,r.status(404).json({success:!1,message:"Payment link not found."}));case 3:return e.a(2,r.status(200).json({success:!0,message:"Payment link status updated successfully.",data:a}));case 4:return e.p=4,s=e.v,console.error("Status update error:",s),e.a(2,r.status(500).json({success:!1,message:"Failed to update payment link status.",error:s.message}))}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}()),ft.get("/api/payment-links/:id",O,function(){var e=lt(ct().m(function e(t,r){var n,o,a;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.id,e.p=1,e.n=2,st.findById(n);case 2:if(o=e.v){e.n=3;break}return e.a(2,r.status(404).json({success:!1,message:"Not found"}));case 3:r.json({success:!0,data:o}),e.n=5;break;case 4:e.p=4,a=e.v,r.status(400).json({success:!1,error:a.message});case 5:return e.a(2)}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}()),ft.get("/qr-codes",O,function(){var e=lt(ct().m(function e(t,r){var n,o,a,s;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=t.query.userId,o={},n&&(o.user=n),e.n=1,ut.find(o).populate("user","name email user_role").sort({createdAt:-1});case 1:return a=e.v,e.a(2,r.status(200).json({success:!0,count:a.length,data:a}));case 2:return e.p=2,s=e.v,console.error("Get Payment QR Error:",s),e.a(2,r.status(500).json({success:!1,message:"Failed to fetch payment QR codes"}))}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}());const yt=ft;function vt(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return gt(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(gt(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,gt(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,gt(d,"constructor",c),gt(c,"constructor",u),u.displayName="GeneratorFunction",gt(c,o,"GeneratorFunction"),gt(d),gt(d,o,"Generator"),gt(d,n,function(){return this}),gt(d,"toString",function(){return"[object Generator]"}),(vt=function(){return{w:a,m:l}})()}function gt(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}gt=function(e,t,r,n){function a(t,r){gt(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},gt(e,t,r,n)}function bt(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}function ht(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){bt(a,n,o,s,i,"next",e)}function i(e){bt(a,n,o,s,i,"throw",e)}s(void 0)})}}var wt=n.Router();wt.post("/add",function(){var e=ht(vt().m(function e(t,r){var n,o,a,s,i,u,c,p,d,l;return vt().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.body,o=n.name,a=n.companyName,s=n.phoneNumber,i=n.email,u=n.location,c=n.service,p=n.message,o&&s&&i){e.n=1;break}return e.a(2,r.status(400).send({message:"name, phoneNumber and email are required"}));case 1:return e.p=1,e.n=2,qe.A.findOne({email:i,phoneNumber:s});case 2:if(!e.v){e.n=3;break}return e.a(2,r.status(409).send({message:"Entry with same email and phone already exists"}));case 3:return e.n=4,qe.A.create({name:o,companyName:a,phoneNumber:s,email:i,location:u,service:c,message:p});case 4:return d=e.v,e.a(2,r.status(201).send({message:"Email entry created",id:d._id,created:d}));case 5:return e.p=5,l=e.v,console.error(l),e.a(2,r.status(500).send({message:l.message}))}},e,null,[[1,5]])}));return function(t,r){return e.apply(this,arguments)}}()),wt.get("/all",function(){var e=ht(vt().m(function e(t,r){var n,o;return vt().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,qe.A.find().sort({createdAt:-1});case 1:return n=e.v,e.a(2,r.status(200).send(n));case 2:return e.p=2,o=e.v,console.error(o),e.a(2,r.status(500).send({message:o.message}))}},e,null,[[0,2]])}));return function(t,r){return e.apply(this,arguments)}}()),wt.get("/:id",function(){var e=ht(vt().m(function e(t,r){var n,o,a;return vt().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.id,e.p=1,e.n=2,qe.A.findById(n);case 2:if(o=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Not found"}));case 3:return e.a(2,r.status(200).send(o));case 4:return e.p=4,a=e.v,console.error(a),e.a(2,r.status(500).send({message:a.message}))}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}()),wt.patch("/:id",function(){var e=ht(vt().m(function e(t,r){var n,o,a,s;return vt().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.params.id,o=t.body,e.p=1,e.n=2,qe.A.findByIdAndUpdate(n,{$set:o},{new:!0});case 2:if(a=e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Not found"}));case 3:return e.a(2,r.status(200).send({message:"Updated successfully",updated:a}));case 4:return e.p=4,s=e.v,console.error(s),e.a(2,r.status(500).send({message:s.message}))}},e,null,[[1,4]])}));return function(t,r){return e.apply(this,arguments)}}()),wt.delete("/:id",function(){var e=ht(vt().m(function e(t,r){var n,o;return vt().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=t.params.id,"srdev"===t.headers["user-role"]){e.n=1;break}return e.a(2,r.status(403).send({message:"Only srdev can permanently delete entries."}));case 1:return e.p=1,e.n=2,qe.A.findById(n);case 2:if(e.v){e.n=3;break}return e.a(2,r.status(404).send({message:"Not found"}));case 3:return e.n=4,qe.A.findByIdAndDelete(n);case 4:return e.a(2,r.status(200).send({message:"Deleted successfully"}));case 5:return e.p=5,o=e.v,console.error(o),e.a(2,r.status(500).send({message:o.message}))}},e,null,[[1,5]])}));return function(t,r){return e.apply(this,arguments)}}());const Ot=wt;function kt(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var u=n&&n.prototype instanceof i?n:i,c=Object.create(u.prototype);return St(c,"_invoke",function(r,n,o){var a,i,u,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,u=e,l.n=r,s}};function f(r,n){for(i=r,u=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,i=0))}if(o||r>1)return s;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),i=p,u=m;(t=i<2?e:u)||!d;){a||(i?i<3?(i>1&&(l.n=-1),f(i,u)):l.n=u:l.v=u);try{if(c=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=l.n<0)?u:r.call(n,l))!==s)break}catch(t){a=e,i=1,u=t}finally{c=1}}return{value:t,done:d}}}(r,o,a),!0),c}var s={};function i(){}function u(){}function c(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(St(t={},n,function(){return this}),t),d=c.prototype=i.prototype=Object.create(p);function l(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,St(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=c,St(d,"constructor",c),St(c,"constructor",u),u.displayName="GeneratorFunction",St(c,o,"GeneratorFunction"),St(d),St(d,o,"Generator"),St(d,n,function(){return this}),St(d,"toString",function(){return"[object Generator]"}),(kt=function(){return{w:a,m:l}})()}function St(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}St=function(e,t,r,n){function a(t,r){St(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},St(e,t,r,n)}function _t(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}v.config();var jt=process.env.MAIL_USER,Pt=process.env.MAIL_PASS,At=n.Router();At.post("/api/welcome",function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function s(e){_t(a,n,o,s,i,"next",e)}function i(e){_t(a,n,o,s,i,"throw",e)}s(void 0)})}}(kt().m(function e(t,r){var n,o,a,s,i,u;return kt().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=t.body,o=n.email,a=n.name,n.amount,e.p=1,s=m.createTransport({host:"smtp.hostinger.com",port:465,secure:!0,auth:{user:"".concat(jt),pass:"".concat(Pt)}}),i={to:"".concat(o),from:"no-reply@finseraa.org",subject:"Warm Welcome to ".concat(a,"  from Finsera Ventures Private Limited\n"),html:"\n        <p>Dear Sir/Madam,</p>\n\n        <p>\n          We are pleased to extend a warm welcome to <b>".concat(a,"</b> as a valued client of \n          <b>Finsera Ventures Private Limited</b>. We sincerely appreciate the trust youâ€™ve placed in us and are \n          excited about the opportunity to collaborate and contribute to your success.\n        </p>\n\n        <p>\n          At <b>Finsera Ventures Private Limited</b>, we are dedicated to offering high-quality, tailored services \n          designed to meet the unique needs of <b>").concat(a,"</b>. Our experienced team is committed to providing \n          expert support and guidance at every stage of our partnership to ensure a smooth and successful experience.\n        </p>\n\n        <p>\n          To facilitate a seamless process, one of our dedicated representatives will be in touch shortly \n          to coordinate with you and gather any necessary information. Please donâ€™t hesitate to reach out \n          with any questions, concerns, or special requests. Your satisfaction is our highest priority, and \n          we are here to support you every step of the way.\n        </p>\n\n        <p>\n          Thank you once again for choosing <b>Finsera Ventures Private Limited</b>. We look forward to a successful \n          and fruitful collaboration, and to helping <b>").concat(a,'</b> achieve its business objectives.\n        </p>\n\n        <p>\n          For any queries kindly mail us at <a href="mailto:support@finseraa.org">support@finseraa.org</a>\n        </p>\n\n        <p style="color: #555; font-size: 14px; margin-top: 20px;">\n          <i>This is a system-generated email. Please do not reply to this email.</i>\n        </p>\n\n        <p>Warm regards,</p>\n        <p><b>Finsera Ventures Private Limited</b></p>\n        <p><a href="https://Finseraa.com">Finseraa.com</a></p>\n      ')},e.n=2,s.sendMail(i);case 2:r.status(200).json({message:"Welcome Mail Sent Successfully."}),e.n=4;break;case 3:e.p=3,u=e.v,r.status(500).json({message:"Server error.",error:u.message});case 4:return e.a(2)}},e,null,[[1,3]])}));return function(t,r){return e.apply(this,arguments)}}());const Et=At;var Tt=n.Router();Tt.get("/",function(e,t){t.status(200).json({status:"ok",time:(new Date).toISOString()})});const It=Tt;var xt=(0,n.Router)();xt.use("/user",q),xt.use("/booking",$),xt.use("/services",J),xt.use("/employee",_e),xt.use("/invoice",Ne),xt.use("/leads",Fe),xt.use("/admin",He),xt.use("/payments",yt),xt.use("/email",Ot),xt.use("/mail",Et),xt.use("/health",It);const Nt=xt;require("swagger-ui-express"),require("swagger-jsdoc")({definition:{openapi:"3.0.0",info:{title:"CRM Backend API",version:"1.0.0",description:"API documentation for CRM Backend",contact:{name:"Rizvan",email:"rizvan@finseraa.com",url:"https://rizvan.is-a.dev/"}},servers:[{url:"http://localhost:5353",description:"Local server"},{url:"https://your-production-domain.com",description:"Production server"}],components:{securitySchemes:{authToken:{type:"apiKey",in:"header",name:"authorization",description:"JWT token (NO Bearer prefix)"}},schemas:{Booking:{type:"object",properties:{_id:{type:"string"},user_id:{type:"string"},bdm:{type:"string"},branch_name:{type:"string"},company_name:{type:"string"},contact_person:{type:"string"},email:{type:"string"},contact_no:{type:"string"},services:{type:"array",items:{type:"string"}},total_amount:{type:"number"},payment_date:{type:"string",format:"date-time"},status:{type:"string"},bank:{type:"string"},state:{type:"string"},isDeleted:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}}},LeadModel:{type:"object",properties:{_id:{type:"string"},name:{type:"string"},companyName:{type:"string"},phoneNumber:{type:"string"},email:{type:"string"},location:{type:"string"},service:{type:"string"},message:{type:"string"},assignedTo:{type:"string",example:"unassigned"},isDeleted:{type:"boolean",example:!1},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}}},EmployeeModel:{type:"object",properties:{userId:{type:"string"},employeeId:{type:"string"},employeeFullName:{type:"string"},designation:{type:"string"},department:{type:"string"},branch:{type:"string"},gender:{type:"string"},maritalStatus:{type:"string"},dateOfBirth:{type:"string",format:"date"},dateOfJoining:{type:"string",format:"date"},reportingManager:{type:"string"},personalEmailAddress:{type:"string"},workEmail:{type:"string"},personalContactNumber:{type:"string"},workPhoneNumber:{type:"string"},profileCompletionStatus:{type:"string",example:"approved"},isActive:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}}},paymentLinkModel:{type:"object",required:["customer","contact","amount","bdm","link"],properties:{customer:{type:"string",example:"Rahul Sharma"},contact:{type:"string",example:"9876543210"},amount:{type:"number",minimum:1,example:15e3},bdm:{type:"string",example:"BDM001",description:"Business Development Manager ID or Name"},description:{type:"string",example:"GST filing payment"},link:{type:"string",example:"https://rzp.io/i/AbCdEf"},status:{type:"string",enum:["PENDING","PAID","EXPIRED","FAILED"],example:"PENDING"}}},paymentQRModel:{type:"object",required:["name","amount","qr_id"],properties:{name:{type:"string",example:"Rahul Sharma"},bdm:{type:"string",example:"BDM001",description:"Business Development Manager identifier"},amount:{type:"number",example:25e3},description:{type:"string",example:"UPI QR payment for GST filing"},qr_id:{type:"string",example:"qr_FGk92kLmPq",description:"Unique Razorpay QR ID"},qr_image:{type:"string",example:"https://api.razorpay.com/v1/qr_codes/qr_FGk92kLmPq"},usage:{type:"string",example:"single_use"},purpose:{type:"string",example:"UPI QR Payment"},fixed_amount:{type:"boolean",example:!0},close_by:{type:"number",example:1735689600,description:"Unix timestamp when QR expires"},status:{type:"string",enum:["Pending","Paid","Expired","Cancelled"],example:"Pending"}}},ServiceModel:{type:"object",properties:{_id:{type:"string"},label:{type:"string"},value:{type:"string"},status:{type:"string",example:"active"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}}},UserModel:{type:"object",properties:{_id:{type:"string"},name:{type:"string"},email:{type:"string"},user_role:{type:"string",example:"admin"},isActive:{type:"boolean",example:!0},createdAt:{type:"string",format:"date-time"}}},InvoiceModel:{type:"object",properties:{_id:{type:"string"},invoiceNumber:{type:"string"},customerName:{type:"string"},customerEmail:{type:"string"},amount:{type:"number"},taxAmount:{type:"number"},totalAmount:{type:"number"},status:{type:"string"},dueDate:{type:"string",format:"date"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}}}}},security:[{authToken:[]}]},apis:["./src/api/v1/routes/**/*.js"]});var qt=n();qt.use(n.json()),qt.use(o({origin:"*",methods:["GET","POST","PUT","DELETE","PATCH"],allowedHeaders:["Content-Type","Authorization","user-role"]})),qt.use(i),qt.use("/api/v1",Nt),qt.get("/",function(e,t){t.send("âœ… Server running")});const Gt=qt},695:(e,t,r)=>{r.d(t,{A:()=>c});var n=r(124),o=(r(233),r(195)),a=n.createLogger,s=n.format,i=n.transports,u=[];o.A.logging.toConsole&&u.push(new i.Console({format:s.combine(s.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),s.printf(function(e){var t=e.timestamp,r=e.level,n=e.message;return"[".concat(t,"] ").concat(r.toUpperCase(),": ").concat(n)}))})),o.A.logging.toFile&&u.push(new i.DailyRotateFile({filename:"".concat(o.A.logging.directory,"/%DATE%-combined.txt"),datePattern:"YYYY-MM-DD",maxSize:"10m",maxFiles:"14d",zippedArchive:o.A.logging.compress,format:s.combine(s.timestamp(),s.json())}));const c=a({level:o.A.logging.level,transports:u})},703:e=>{e.exports=require("node-cron")},818:e=>{e.exports=require("dotenv")},887:(e,t,r)=>{r.d(t,{F:()=>i});var n=r(37);function o(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",s=r.toStringTag||"@@toStringTag";function i(r,n,o,s){var i=n&&n.prototype instanceof c?n:c,p=Object.create(i.prototype);return a(p,"_invoke",function(r,n,o){var a,s,i,c=0,p=o||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,s=0,i=e,l.n=r,u}};function f(r,n){for(s=r,i=n,t=0;!d&&c&&!o&&t<p.length;t++){var o,a=p[t],f=l.p,m=a[2];r>3?(o=m===n)&&(i=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(s=0,l.v=n,l.n=a[1]):f<m&&(o=r<3||a[0]>n||n>m)&&(a[4]=r,a[5]=n,l.n=m,s=0))}if(o||r>1)return u;throw d=!0,n}return function(o,p,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,m),s=p,i=m;(t=s<2?e:i)||!d;){a||(s?s<3?(s>1&&(l.n=-1),f(s,i)):l.n=i:l.v=i);try{if(c=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,i)))throw TypeError("iterator result is not an object");if(!t.done)return t;i=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=l.n<0)?i:r.call(n,l))!==u)break}catch(t){a=e,s=1,i=t}finally{c=1}}return{value:t,done:d}}}(r,o,s),!0),p}var u={};function c(){}function p(){}function d(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(a(t={},n,function(){return this}),t),f=d.prototype=c.prototype=Object.create(l);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,s,"GeneratorFunction")),e.prototype=Object.create(f),e}return p.prototype=d,a(f,"constructor",d),a(d,"constructor",p),p.displayName="GeneratorFunction",a(d,s,"GeneratorFunction"),a(f),a(f,s,"Generator"),a(f,n,function(){return this}),a(f,"toString",function(){return"[object Generator]"}),(o=function(){return{w:i,m}})()}function a(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}a=function(e,t,r,n){function s(t,r){a(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(s("next",0),s("throw",1),s("return",2))},a(e,t,r,n)}function s(e,t,r,n,o,a,s){try{var i=e[a](s),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,o)}r(818).config(),process.env.PORT;var i=function(){var e,t=(e=o().m(function e(){var t,r;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,n.connect(process.env.MONGO_URI);case 1:t=e.v,console.log("MongoDB Connected: ".concat(t.connection.host)),e.n=3;break;case 2:e.p=2,r=e.v,console.log({msg:"cannot connect to db",error:r.message}),process.exit(1);case 3:return e.a(2)}},e,null,[[0,2]])}),function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){s(a,n,o,i,u,"next",e)}function u(e){s(a,n,o,i,u,"throw",e)}i(void 0)})});return function(){return t.apply(this,arguments)}}()},928:e=>{e.exports=require("path")}},i={};function u(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return s[e](r,r.exports,u),r.exports}u.m=s,e="function"==typeof Symbol,t=e?Symbol("webpack queues"):"__webpack_queues__",r=e?Symbol("webpack exports"):"__webpack_exports__",n=e?Symbol("webpack error"):"__webpack_error__",o=e=>{e&&e.d<1&&(e.d=1,e.forEach(e=>e.r--),e.forEach(e=>e.r--?e.r++:e()))},u.a=(e,a,s)=>{var i;s&&((i=[]).d=-1);var u,c,p,d=new Set,l=e.exports,f=new Promise((e,t)=>{p=t,c=e});f[r]=l,f[t]=e=>(i&&e(i),d.forEach(e),f.catch(e=>{})),e.exports=f,a(e=>{var a;u=(e=>e.map(e=>{if(null!==e&&"object"==typeof e){if(e[t])return e;if(e.then){var a=[];a.d=0,e.then(e=>{s[r]=e,o(a)},e=>{s[n]=e,o(a)});var s={};return s[t]=e=>e(a),s}}var i={};return i[t]=e=>{},i[r]=e,i}))(e);var s=()=>u.map(e=>{if(e[n])throw e[n];return e[r]}),c=new Promise(e=>{(a=()=>e(s)).r=0;var r=e=>e!==i&&!d.has(e)&&(d.add(e),e&&!e.d&&(a.r++,e.push(a)));u.map(e=>e[t](r))});return a.r?c:s()},e=>(e?p(f[n]=e):c(l),o(i))),i&&i.d<0&&(i.d=0)},u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.f={},u.e=e=>Promise.all(Object.keys(u.f).reduce((t,r)=>(u.f[r](e,t),t),[])),u.u=e=>e+".bundle.js",u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a={792:1},u.f.require=(e,t)=>{if(!a[e]){var r=require("./"+u.u(e));a[e]||(e=>{var t=e.modules,r=e.ids,n=e.runtime;for(var o in t)u.o(t,o)&&(u.m[o]=t[o]);n&&n(u);for(var s=0;s<r.length;s++)a[r[s]]=1})(r)}},u(26)})();